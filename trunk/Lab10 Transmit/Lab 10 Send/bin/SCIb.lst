*** EVALUATION ***
ANSI-C/cC++ Compiler for HC12 V-5.0.40 Build 10020, Jan 21 2010

    1:  // filename ************** SCIb.C *****************************
    2:  // Interrupting I/O routines to 9S12DP512 virtual serial port 
    3:  
    4:  // 9S12DP512 PT2 is RxD (input to 9S12DP512) 
    5:  // 9S12DP512 PT3 is TxD (output from 9S12DP512)
    6:  // 9S12DP512 channel 4 output compare interrupt used 
    7:  // baud rate can be from 1000 to 50000 bits/sec
    8:  // 1 start bit, 8 bit data, 1 stop
    9:  // Jonathan W. Valvano 11/12/09
   10:  
   11:  //  This example accompanies the books
   12:  //   "Embedded Microcomputer Systems: Real Time Interfacing",
   13:  //        Thompson, copyright (c) 2006,
   14:  //   "Introduction to Embedded Systems: Interfacing to the Freescale 9S12",
   15:  //        Cengage Publishing 2009, ISBN-10: 049541137X | ISBN-13: 9780495411376
   16:  
   17:  // Copyright 2009 by Jonathan W. Valvano, valvano@mail.utexas.edu 
   18:  //    You may use, edit, run or distribute this file 
   19:  //    as long as the above copyright notice remains 
   20:  
   21:  #include "derivative.h"      /* derivative-specific definitions */
   22:  #include "SCIb.h"
   23:  #include "RxFifob.h"  
   24:  #include "TxFifob.h" 
   25:   
   26:  // Tx interrupt rate at the baud rate
   27:  // Rx interrupt rate at the baud rate
   28:  // change the following two defines in order to adjust baud rate
   29:  unsigned short BitTime;     // 24000000/baudrate
   30:  unsigned short HalfBitTime; // 24000000/baudrate/2
   31:  // E.g., for 9600, BitTime=2500 
   32:  
   33:  static unsigned short TxCount,TxData; // transmit shift register
   34:  static unsigned char RxCount,RxData;  // receive shift register
   35:  unsigned char RxFull,NoStart,NoStop;  // number of receiver errors
   36:  
   37:  //-------------------------SCIb_Init------------------------
   38:  // Initialize virtual Serial port SCI
   39:  // baudrate can be from 1000 to 50000 bits/sec
   40:  // 1 start, 8 data, 1 stop bit
   41:  // Input: none
   42:  // Output: none
   43:  // assumes a module clock frequency of 24 MHz
   44:  void SCIb_Init(unsigned short baudrate){
*** EVALUATION ***

Function: SCIb_Init
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  0000 3b           [2]     PSHD  
   45:    RxFifob_Init();
  0001 160000       [4]     JSR   RxFifob_Init
   46:    TxFifob_Init();
  0004 160000       [4]     JSR   TxFifob_Init
   47:    BitTime = (unsigned short)(24000000L/(unsigned long)baudrate);
  0007 ec80         [3]     LDD   0,SP
  0009 3b           [2]     PSHD  
  000a c7           [1]     CLRB  
  000b 87           [1]     CLRA  
  000c 3b           [2]     PSHD  
  000d 8636         [1]     LDAA  #54
  000f ce016e       [2]     LDX   #366
  0012 160000       [4]     JSR   _LDIVU
  0015 7c0000       [3]     STD   BitTime
   48:    HalfBitTime = BitTime/2;
  0018 49           [1]     LSRD  
  0019 7c0000       [3]     STD   HalfBitTime
   49:    DDRT |= 0x08;     // PT3 is TxD output
  001c 1c000008     [4]     BSET  _DDRT,#8
   50:    DDRT &= ~0x04;    // PT2 RxD input
  0020 1d000004     [4]     BCLR  _DDRT,#4
   51:    //PERT |= 0x04;     // internal pullup on PT2
   52:    PTT  |= 0x08;     // PT3 high TxD idle
  0024 1c000008     [4]     BSET  _PTT,#8
   53:    RxFull = 0; NoStart = 0; NoStop = 0; 
  0028 790000       [3]     CLR   RxFull
  002b 790000       [3]     CLR   NoStart
  002e 790000       [3]     CLR   NoStop
   54:    RxCount =0;       // means receiver is idle
  0031 790000       [3]     CLR   RxCount
   55:    TxCount =0;       // means transmitter is idle
  0034 c7           [1]     CLRB  
  0035 87           [1]     CLRA  
  0036 7c0000       [3]     STD   TxCount
   56:    TIOS  &= ~0x04;   // activate TC2 as input capture
  0039 4d0004       [4]     BCLR  _TIOS,#4
   57:    TIOS  |= 0x18;    // activate TC3,TC4 as output compares
  003c 4c0018       [4]     BSET  _TIOS,#24
   58:    TSCR1 = 0x80;     // Enable TCNT, 24MHz 
  003f c680         [1]     LDAB  #128
  0041 5b00         [2]     STAB  _TSCR1
   59:    TSCR2 = 0x00;     // divide by 1 TCNT prescale, TOI disarm
  0043 5a00         [2]     STAA  _TSCR2
   60:    PACTL = 0;        // timer prescale used for TCNT
  0045 5a00         [2]     STAA  _PACTL
   61:    TCTL4 = 0x20;     // falling edge IC2
  0047 c620         [1]     LDAB  #32
  0049 5b00         [2]     STAB  _TCTL4
   62:    TIE  |= 0x0C;     // arm OC3, IC2
  004b 4c000c       [4]     BSET  _TIE,#12
   63:    TC3   = TCNT+50;  // first interrupt right away
  004e de00         [3]     LDX   _TCNT
  0050 1ae032       [2]     LEAX  50,X
  0053 5e00         [2]     STX   _TC3
   64:    asm cli   /* enable interrupts */
  0055 10ef         [1]     CLI   
   65:  }
  0057 3a           [3]     PULD  
  0058 3d           [5]     RTS   
   66:  
   67:  //-------------------------SCIb_Clear------------------------
   68:  // Initialize buffers, halt activity
   69:  // Input: none
   70:  // Output: none
   71:  void SCIb_Clear(void){
*** EVALUATION ***

Function: SCIb_Clear
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

   72:    RxFifob_Init();
  0000 160000       [4]     JSR   RxFifob_Init
   73:    TxFifob_Init();
  0003 160000       [4]     JSR   TxFifob_Init
   74:    PTT  |= 0x08;     // PT3 high TxD idle
  0006 1c000008     [4]     BSET  _PTT,#8
   75:    RxFull = 0; NoStart = 0; NoStop = 0; 
  000a 790000       [3]     CLR   RxFull
  000d 790000       [3]     CLR   NoStart
  0010 790000       [3]     CLR   NoStop
   76:    RxCount =0;       // means receiver is idle
  0013 790000       [3]     CLR   RxCount
   77:    TxCount =0;       // means transmitter is idle
  0016 c7           [1]     CLRB  
  0017 87           [1]     CLRA  
  0018 7c0000       [3]     STD   TxCount
   78:  }  
  001b 3d           [5]     RTS   
   79:    
   80:  //-------------------------SCIb_InChar-----------------------
   81:  // Wait for new serial port input, interrupt synchronization
   82:  // Input: none
   83:  // Output: ASCII code for key typed
   84:  unsigned char SCIb_InChar(void){ 
*** EVALUATION ***

Function: SCIb_InChar
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  0000 1b9d         [2]     LEAS  -3,SP
   85:  unsigned char letter;
   86:  unsigned short time = TCNT;
  0002 dc00         [3]     LDD   _TCNT
  0004 6c81         [2]     STD   1,SP
   87:    while (RxFifob_Get(&letter) == 0){
  0006 200c         [3]     BRA   *+14 ;abs = 0014
   88:      if(TCNT - time > 1000) return 0;
  0008 dc00         [3]     LDD   _TCNT
  000a a381         [3]     SUBD  1,SP
  000c 8c03e8       [2]     CPD   #1000
  000f 2303         [3/1]   BLS   *+5 ;abs = 0014
  0011 c7           [1]     CLRB  
  0012 200a         [3]     BRA   *+12 ;abs = 001e
  0014 b774         [1]     TFR   SP,D
  0016 160000       [4]     JSR   RxFifob_Get
  0019 0454ec       [3]     TBEQ  D,*-17 ;abs = 0008
   89:    };
   90:    return(letter);
  001c e680         [3]     LDAB  0,SP
   91:  }
  001e 1b83         [2]     LEAS  3,SP
  0020 3d           [5]     RTS   
   92:  
   93:  //-------------------------SCIb_InChar2------------------------
   94:  // Wait for new serial port input, interrupt synchronization
   95:  // Input: none
   96:  // Output: ASCII code for key typed
   97:  // Worst case response time is 20 ms
   98:  // so it returns with 0xFE if no response in 20 ms
   99:  unsigned char SCIb_InChar2(void){ 
*** EVALUATION ***

Function: SCIb_InChar2
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  100:    unsigned char letter;
  101:    short TimeLeft,EndT;
  102:    unsigned short timeOut=2000; // 20ms
  0000 cc07d0       [2]     LDD   #2000
  0003 6ca9         [2]     STD   7,-SP
  103:    while (RxFifob_Get(&letter) == 0){
  0005 201f         [3]     BRA   *+33 ;abs = 0026
  104:      EndT = TCNT+240;       // 240 counts (42ns cycles) in 10us 
  0007 dc00         [3]     LDD   _TCNT
  0009 c300f0       [2]     ADDD  #240
  000c 6c83         [2]     STD   3,SP
  105:      do{
  106:        TimeLeft = (short)TCNT-EndT;
  000e dc00         [3]     LDD   _TCNT
  0010 a383         [3]     SUBD  3,SP
  0012 6c85         [2]     STD   5,SP
  107:      }
  108:      while((TimeLeft<0)||(TimeLeft>100));   // wait 10us
  0014 2df8         [3/1]   BLT   *-6 ;abs = 000e
  0016 8c0064       [2]     CPD   #100
  0019 2ef3         [3/1]   BGT   *-11 ;abs = 000e
  109:      timeOut--;
  001b ee80         [3]     LDX   0,SP
  001d 09           [1]     DEX   
  001e 6e80         [2]     STX   0,SP
  110:      if(timeOut == 0){
  0020 2604         [3/1]   BNE   *+6 ;abs = 0026
  111:        return(0xFE);
  0022 c6fe         [1]     LDAB  #254
  0024 200c         [3]     BRA   *+14 ;abs = 0032
  0026 1a82         [2]     LEAX  2,SP
  0028 b754         [1]     TFR   X,D
  002a 160000       [4]     JSR   RxFifob_Get
  002d 0454d7       [3]     TBEQ  D,*-38 ;abs = 0007
  112:      }
  113:    }
  114:    return(letter);
  0030 e682         [3]     LDAB  2,SP
  115:  }
  0032 1b87         [2]     LEAS  7,SP
  0034 3d           [5]     RTS   
  116:  
  117:  //-------------------------SCIb_OutChar------------------------
  118:  // Wait for buffer to be empty, output 8-bit to serial port
  119:  // interrupt synchronization
  120:  // Input: 8-bit data to be transferred
  121:  // Output: none
  122:  void SCIb_OutChar(unsigned char data){
*** EVALUATION ***

Function: SCIb_OutChar
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  0000 37           [2]     PSHB  
  123:    while (TxFifob_Put(data) == 0){}; // spin if TxFifo is full
  0001 e680         [3]     LDAB  0,SP
  0003 160000       [4]     JSR   TxFifob_Put
  0006 0454f8       [3]     TBEQ  D,*-5 ;abs = 0001
  124:  }
  0009 32           [3]     PULA  
  000a 3d           [5]     RTS   
  125:      
  126:  //-------------------------SCIb_InStatus--------------------------
  127:  // Checks if new input is ready, TRUE if new input is ready
  128:  // Input: none
  129:  // Output: TRUE if a call to InChar will return right away with data
  130:  //         FALSE if a call to InChar will wait for input
  131:  int SCIb_InStatus(void){  
*** EVALUATION ***

Function: SCIb_InStatus
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  132:    return(RxFifob_Status());
  0000 160000       [4]     JSR   RxFifob_Status
  133:  }
  0003 3d           [5]     RTS   
  134:  
  135:  //-----------------------SCIb_OutStatus----------------------------
  136:  // Checks if there is room in the FIFO, 
  137:  // TRUE if a call to OutChar will not spin
  138:  int SCIb_OutStatus(void){
*** EVALUATION ***

Function: SCIb_OutStatus
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  139:    return(TxFifob_Status());
  0000 160000       [4]     JSR   TxFifob_Status
  140:  }
  0003 3d           [5]     RTS   
  141:  
  142:  /*----------------Input Capture 2 Handler---------------*/
  143:  // used to detect start bit on RxD input
  144:  // PT2=RxD input
  145:  // ______			 ____ ____ ____ ____ ____ ____ ____ ____ ______
  146:  //       |  S | 0  | 1  | 2  | 3  | 4  | 5  | 6  | 7  | Stop  
  147:  //       |____|____|____|____|____|____|____|____|____|
  148:  // 			
  149:  // IC2   ^
  150:  // OC4      ^    ^    ^    ^    ^    ^    ^    ^    ^    ^
  151:  interrupt 10 void T2Handler(void){
*** EVALUATION ***

Function: T2Handler
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  152:    TC4 = TC2+HalfBitTime;   // 1/2 bit time later
  0000 dc00         [3]     LDD   _TC2
  0002 f30000       [3]     ADDD  HalfBitTime
  0005 5c00         [2]     STD   _TC4
  153:    TIE  |= 0x10;            // arm OC4
  0007 4c0010       [4]     BSET  _TIE,#16
  154:    TIE  &= ~0x04;           // disarm IC2
  000a 4d0004       [4]     BCLR  _TIE,#4
  155:    RxCount = 10;            // 10 bits/frame
  000d c60a         [1]     LDAB  #10
  000f 7b0000       [3]     STAB  RxCount
  156:    TFLG1 = 0x14;            // acknowledge OC4,IC2
  0012 58           [1]     LSLB  
  0013 5b00         [2]     STAB  _TFLG1
  157:  }
  0015 0b           [8]     RTI   
  158:  
  159:  /*----------------Output Compare 3 Handler---------------*/
  160:  // used to output virtual TxData
  161:  // PT3=TxD output
  162:  // ______			 ____ ____ ____ ____ ____ ____ ____ ____ ______
  163:  //       |  S | 0  | 1  | 2  | 3  | 4  | 5  | 6  | 7  | Stop  
  164:  //       |____|____|____|____|____|____|____|____|____|
  165:  // 			
  166:  // OC3   ^    ^    ^    ^    ^    ^    ^    ^    ^    ^
  167:  interrupt 11 void T3Handler(void){  char data;
*** EVALUATION ***

Function: T3Handler
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  0000 36           [2]     PSHA  
  168:    TFLG1 = 0x08;         // acknowledge OC3
  0001 c608         [1]     LDAB  #8
  0003 5b00         [2]     STAB  _TFLG1
  169:    TC3 = TC3+BitTime;    
  0005 dc00         [3]     LDD   _TC3
  0007 f30000       [3]     ADDD  BitTime
  000a 5c00         [2]     STD   _TC3
  170:    if(TxCount==0){
  000c fc0000       [3]     LDD   TxCount
  000f 261a         [3/1]   BNE   *+28 ;abs = 002b
  171:      if(TxFifob_Get(&data)){
  0011 b774         [1]     TFR   SP,D
  0013 160000       [4]     JSR   TxFifob_Get
  0016 04442d       [3]     TBEQ  D,*+48 ;abs = 0046
  172:        TxData = 0x100+(0xFF&data); // one stop bit+data
  0019 e680         [3]     LDAB  0,SP
  001b 87           [1]     CLRA  
  001c c30100       [2]     ADDD  #256
  001f 7c0000       [3]     STD   TxData
  173:        PTT &= ~0x08;    // start bit
  0022 1d000008     [4]     BCLR  _PTT,#8
  174:        TxCount = 9;
  0026 c609         [1]     LDAB  #9
  0028 87           [1]     CLRA  
  0029 2018         [3]     BRA   *+26 ;abs = 0043
  175:      }
  176:    }
  177:    else {
  178:      if(TxData&0x0001){
  002b 1f00000106   [5]     BRCLR TxData:1,#1,*+11 ;abs = 0036
  179:        PTT |= 0x08;  // data bit high
  0030 1c000008     [4]     BSET  _PTT,#8
  180:      } else{
  0034 2004         [3]     BRA   *+6 ;abs = 003a
  181:        PTT &= ~0x08; // data bit low
  0036 1d000008     [4]     BCLR  _PTT,#8
  182:      }
  183:      TxData = TxData>>1;
  003a 740000       [4]     LSR   TxData
  003d 760000       [4]     ROR   TxData:1
  184:      TxCount--;
  0040 830001       [2]     SUBD  #1
  0043 7c0000       [3]     STD   TxCount
  185:    }
  186:  }
  0046 32           [3]     PULA  
  0047 0b           [8]     RTI   
  187:  /*----------------Output Compare 4 Handler---------------*/
  188:  // used to input virtual RxData
  189:  interrupt 12 void T4Handler(void){ 
*** EVALUATION ***

Function: T4Handler
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  190:    TC4 = TC4+BitTime;    
  0000 dc00         [3]     LDD   _TC4
  0002 f30000       [3]     ADDD  BitTime
  0005 5c00         [2]     STD   _TC4
  191:    RxCount--;
  0007 730000       [4]     DEC   RxCount
  192:    if(RxCount==9){       // check start bit
  000a f60000       [3]     LDAB  RxCount
  000d c109         [1]     CMPB  #9
  000f 260a         [3/1]   BNE   *+12 ;abs = 001b
  193:      if(PTT&0x04){
  0011 1f00000434   [5]     BRCLR _PTT,#4,*+57 ;abs = 004a
  194:        NoStart++;        // framing error, no start
  0016 720000       [4]     INC   NoStart
  0019 202f         [3]     BRA   *+49 ;abs = 004a
  195:      }
  196:    }
  197:    else{
  198:      if(RxCount){	 // RxCount is 8,7,6,5,4,3,2,1
  001b 04410e       [3]     TBEQ  B,*+17 ;abs = 002c
  199:        RxData = RxData >>1;
  001e 740000       [4]     LSR   RxData
  200:        if(PTT&0x04){
  0021 1f00000424   [5]     BRCLR _PTT,#4,*+41 ;abs = 004a
  201:          RxData |= 0x80;	 // data bit is high
  0026 1c000080     [4]     BSET  RxData,#128
  002a 201e         [3]     BRA   *+32 ;abs = 004a
  202:        }
  203:      } 
  204:      else{				        // RxCount is 0
  205:        if((PTT&0x04)==0){
  002c 1e00000403   [5]     BRSET _PTT,#4,*+8 ;abs = 0034
  206:          NoStop++;       // framing error, no stop
  0031 720000       [4]     INC   NoStop
  207:        }
  208:        if(RxFifob_Put(RxData)==0){
  0034 f60000       [3]     LDAB  RxData
  0037 160000       [4]     JSR   RxFifob_Put
  003a 046407       [3]     TBNE  D,*+10 ;abs = 0044
  209:          PTT &= ~0x01;   // PT0 LED on means lost data
  003d 1d000001     [4]     BCLR  _PTT,#1
  210:          RxFull++;       // RxFifo full
  0041 720000       [4]     INC   RxFull
  211:        }
  212:        TIE  |= 0x04;     // arm IC2
  0044 4c0004       [4]     BSET  _TIE,#4
  213:        TIE  &= ~0x10;    // disarm OC4
  0047 4d0010       [4]     BCLR  _TIE,#16
  214:  		}
  215:  	}
  216:  
  217:    TFLG1 = 0x14;         // acknowledge IC2,OC4
  004a c614         [1]     LDAB  #20
  004c 5b00         [2]     STAB  _TFLG1
  218:  
  219:  }
  004e 0b           [8]     RTI   
  220:  
  221:  //-------------------------SCIb_OutString------------------------
  222:  // Output String (NULL termination), interrupt synchronization
  223:  // Input: pointer to a NULL-terminated string to be transferred
  224:  // Output: none
  225:  void SCIb_OutString(char *pt){
*** EVALUATION ***

Function: SCIb_OutString
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  226:    while(*pt){
  0000 b745         [1]     TFR   D,X
  0002 2006         [3]     BRA   *+8 ;abs = 000a
  227:      SCIb_OutChar(*pt);
  0004 34           [2]     PSHX  
  0005 160000       [4]     JSR   SCIb_OutChar
  228:      pt++;
  0008 30           [3]     PULX  
  0009 08           [1]     INX   
  000a e600         [3]     LDAB  0,X
  000c 26f6         [3/1]   BNE   *-8 ;abs = 0004
  229:    }
  230:  }
  000e 3d           [5]     RTS   
  231:  
  232:  //----------------------SCIb_InUDec-------------------------------
  233:  // InUDec accepts ASCII input in unsigned decimal format
  234:  //     and converts to a 16 bit unsigned number
  235:  //     valid range is 0 to 65535
  236:  // Input: none
  237:  // Output: 16-bit unsigned number
  238:  // If you enter a number above 65535, it will truncate without an error
  239:  // Backspace will remove last digit typed
  240:  unsigned short SCIb_InUDec(void){	
*** EVALUATION ***

Function: SCIb_InUDec
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  0000 1b9b         [2]     LEAS  -5,SP
  241:  unsigned short number=0, length=0;
  0002 c7           [1]     CLRB  
  0003 87           [1]     CLRA  
  0004 6c83         [2]     STD   3,SP
  0006 6c81         [2]     STD   1,SP
  242:  char character;
  243:    character = SCIb_InChar();	
  244:    while(character!=CR){ // accepts until carriage return input
  0008 203b         [3]     BRA   *+61 ;abs = 0045
  245:  // The next line checks that the input is a digit, 0-9.
  246:  // If the character is not 0-9, it is ignored and not echoed
  247:      if((character>='0') && (character<='9')) {
  000a c030         [1]     SUBB  #48
  000c c109         [1]     CMPB  #9
  000e 2218         [3/1]   BHI   *+26 ;abs = 0028
  248:        number = 10*number+(character-'0');   // this line overflows if above 65535
  0010 e680         [3]     LDAB  0,SP
  0012 b714         [1]     SEX   B,D
  0014 830030       [2]     SUBD  #48
  0017 b745         [1]     TFR   D,X
  0019 c60a         [1]     LDAB  #10
  001b 87           [1]     CLRA  
  001c ed83         [3]     LDY   3,SP
  001e 13           [3]     EMUL  
  001f 1ae6         [2]     LEAX  D,X
  0021 6e83         [2]     STX   3,SP
  249:        length++;
  0023 ee81         [3]     LDX   1,SP
  0025 08           [1]     INX   
  250:        SCIb_OutChar(character);
  251:      } 
  0026 2016         [3]     BRA   *+24 ;abs = 003e
  252:  // If the input is a backspace, then the return number is
  253:  // changed and a backspace is outputted to the screen
  254:      else if((character==BS) && length){
  0028 e680         [3]     LDAB  0,SP
  002a c108         [1]     CMPB  #8
  002c 2617         [3/1]   BNE   *+25 ;abs = 0045
  002e ee81         [3]     LDX   1,SP
  0030 2713         [3/1]   BEQ   *+21 ;abs = 0045
  255:        number /= 10;
  0032 ec83         [3]     LDD   3,SP
  0034 ce000a       [2]     LDX   #10
  0037 1810         [12]    IDIV  
  0039 6e83         [2]     STX   3,SP
  256:        length--;
  003b ee81         [3]     LDX   1,SP
  003d 09           [1]     DEX   
  003e 6e81         [2]     STX   1,SP
  257:        SCIb_OutChar(character);
  0040 e680         [3]     LDAB  0,SP
  0042 160000       [4]     JSR   SCIb_OutChar
  258:      }
  259:      character = SCIb_InChar();	
  0045 160000       [4]     JSR   SCIb_InChar
  0048 6b80         [2]     STAB  0,SP
  004a c10d         [1]     CMPB  #13
  004c 26bc         [3/1]   BNE   *-66 ;abs = 000a
  260:    }
  261:    return number;
  004e ec83         [3]     LDD   3,SP
  262:  }
  0050 1b85         [2]     LEAS  5,SP
  0052 3d           [5]     RTS   
  263:  
  264:  
  265:  
  266:  //-----------------------SCIb_OutUDec-----------------------
  267:  // Output a 16-bit number in unsigned decimal format
  268:  // Input: 16-bit number to be transferred
  269:  // Output: none
  270:  // Variable format 1-5 digits with no space before or after
  271:  void SCIb_OutUDec(unsigned short n){
*** EVALUATION ***

Function: SCIb_OutUDec
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  0000 3b           [2]     PSHD  
  272:  // This function uses recursion to convert decimal number
  273:  //   of unspecified length as an ASCII string 
  274:    if(n >= 10){
  0001 8c000a       [2]     CPD   #10
  0004 2512         [3/1]   BCS   *+20 ;abs = 0018
  275:      SCIb_OutUDec(n/10);
  0006 ce000a       [2]     LDX   #10
  0009 1810         [12]    IDIV  
  000b b754         [1]     TFR   X,D
  000d 0700         [4]     BSR   SCIb_OutUDec
  276:      n = n%10;
  000f ec80         [3]     LDD   0,SP
  0011 ce000a       [2]     LDX   #10
  0014 1810         [12]    IDIV  
  0016 6c80         [2]     STD   0,SP
  277:    }
  278:    SCIb_OutChar(n+'0'); /* n is between 0 and 9 */
  0018 e681         [3]     LDAB  1,SP
  001a cb30         [1]     ADDB  #48
  001c 160000       [4]     JSR   SCIb_OutChar
  279:  }
  001f 3a           [3]     PULD  
  0020 3d           [5]     RTS   
  280:  
  281:  
  282:  
  283:  //---------------------SCIb_InUHex----------------------------------------
  284:  // Accepts ASCII input in unsigned hexadecimal (base 16) format
  285:  // Input: none
  286:  // Output: 16-bit unsigned number
  287:  // No '$' or '0x' need be entered, just the 1 to 4 hex digits
  288:  // It will convert lower case a-f to uppercase A-F
  289:  //     and converts to a 16 bit unsigned number
  290:  //     value range is 0 to FFFF
  291:  // If you enter a number above FFFF, it will truncate without an error
  292:  // Backspace will remove last digit typed
  293:  unsigned short SCIb_InUHex(void){	
*** EVALUATION ***

Function: SCIb_InUHex
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  0000 1b99         [2]     LEAS  -7,SP
  294:  unsigned short number=0, digit, length=0;
  0002 c7           [1]     CLRB  
  0003 87           [1]     CLRA  
  0004 6c83         [2]     STD   3,SP
  0006 6c85         [2]     STD   5,SP
  295:  char character;
  296:    character = SCIb_InChar();
  297:    while(character!=CR){	
  0008 2068         [3]     BRA   *+106 ;abs = 0072
  298:      digit = 0x10; // assume bad
  000a c610         [1]     LDAB  #16
  000c 87           [1]     CLRA  
  000d 6c81         [2]     STD   1,SP
  299:      if((character>='0') && (character<='9')){
  000f e680         [3]     LDAB  0,SP
  0011 c030         [1]     SUBB  #48
  0013 c109         [1]     CMPB  #9
  0015 2209         [3/1]   BHI   *+11 ;abs = 0020
  300:        digit = character-'0';
  0017 e680         [3]     LDAB  0,SP
  0019 b715         [1]     SEX   B,X
  001b 1ae1d0       [2]     LEAX  -48,X
  301:      }
  001e 2020         [3]     BRA   *+34 ;abs = 0040
  302:      else if((character>='A') && (character<='F')){ 
  0020 e680         [3]     LDAB  0,SP
  0022 c041         [1]     SUBB  #65
  0024 c105         [1]     CMPB  #5
  0026 2209         [3/1]   BHI   *+11 ;abs = 0031
  303:        digit = (character-'A')+0xA;
  0028 e680         [3]     LDAB  0,SP
  002a b715         [1]     SEX   B,X
  002c 1ae1c9       [2]     LEAX  -55,X
  304:      }
  002f 200f         [3]     BRA   *+17 ;abs = 0040
  305:      else if((character>='a') && (character<='f')){ 
  0031 e680         [3]     LDAB  0,SP
  0033 c061         [1]     SUBB  #97
  0035 c105         [1]     CMPB  #5
  0037 2209         [3/1]   BHI   *+11 ;abs = 0042
  306:        digit = (character-'a')+0xA;
  0039 e680         [3]     LDAB  0,SP
  003b b715         [1]     SEX   B,X
  003d 1ae1a9       [2]     LEAX  -87,X
  0040 6e81         [2]     STX   1,SP
  307:      }
  308:  // If the character is not 0-9 or A-F, it is ignored and not echoed
  309:      if(digit<=0xF ){	
  0042 ec81         [3]     LDD   1,SP
  0044 8c000f       [2]     CPD   #15
  0047 220f         [3/1]   BHI   *+17 ;abs = 0058
  310:        number = number*0x10+digit;
  0049 ec83         [3]     LDD   3,SP
  004b 59           [1]     LSLD  
  004c 59           [1]     LSLD  
  004d 59           [1]     LSLD  
  004e 59           [1]     LSLD  
  004f e381         [3]     ADDD  1,SP
  0051 6c83         [2]     STD   3,SP
  311:        length++;
  0053 ee85         [3]     LDX   5,SP
  0055 08           [1]     INX   
  312:        SCIb_OutChar(character);
  313:      }
  0056 2013         [3]     BRA   *+21 ;abs = 006b
  314:  // Backspace outputted and return value changed if a backspace is inputted
  315:      else if(character==BS && length){
  0058 e680         [3]     LDAB  0,SP
  005a c108         [1]     CMPB  #8
  005c 2614         [3/1]   BNE   *+22 ;abs = 0072
  005e ee85         [3]     LDX   5,SP
  0060 2710         [3/1]   BEQ   *+18 ;abs = 0072
  316:        number /=0x10;
  0062 ec83         [3]     LDD   3,SP
  0064 49           [1]     LSRD  
  0065 49           [1]     LSRD  
  0066 49           [1]     LSRD  
  0067 49           [1]     LSRD  
  0068 6c83         [2]     STD   3,SP
  317:        length--;
  006a 09           [1]     DEX   
  006b 6e85         [2]     STX   5,SP
  318:        SCIb_OutChar(character);
  006d e680         [3]     LDAB  0,SP
  006f 160000       [4]     JSR   SCIb_OutChar
  319:      }
  320:      character = SCIb_InChar();
  0072 160000       [4]     JSR   SCIb_InChar
  0075 6b80         [2]     STAB  0,SP
  0077 c10d         [1]     CMPB  #13
  0079 268f         [3/1]   BNE   *-111 ;abs = 000a
  321:    }
  322:    return number;
  007b ec83         [3]     LDD   3,SP
  323:  }
  007d 1b87         [2]     LEAS  7,SP
  007f 3d           [5]     RTS   
  324:  
  325:  //--------------------------SCIb_OutUHex----------------------------
  326:  // Output a 16 bit number in unsigned hexadecimal format
  327:  // Input: 16-bit number to be transferred
  328:  // Output: none
  329:  // Variable format 1 to 4 digits with no space before or after
  330:  void SCIb_OutUHex(unsigned short number){
*** EVALUATION ***

Function: SCIb_OutUHex
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  0000 3b           [2]     PSHD  
  331:  // This function uses recursion to convert the number of 
  332:  //   unspecified length as an ASCII string
  333:    if(number>=0x10)	{
  0001 8c0010       [2]     CPD   #16
  0004 250f         [3/1]   BCS   *+17 ;abs = 0015
  334:      SCIb_OutUHex(number/0x10);
  0006 49           [1]     LSRD  
  0007 49           [1]     LSRD  
  0008 49           [1]     LSRD  
  0009 49           [1]     LSRD  
  000a 0700         [4]     BSR   SCIb_OutUHex
  335:      SCIb_OutUHex(number%0x10);
  000c ec80         [3]     LDD   0,SP
  000e c40f         [1]     ANDB  #15
  0010 87           [1]     CLRA  
  0011 0700         [4]     BSR   SCIb_OutUHex
  336:    }
  0013 2012         [3]     BRA   *+20 ;abs = 0027
  337:    else if(number<0xA){
  0015 8c000a       [2]     CPD   #10
  0018 2406         [3/1]   BCC   *+8 ;abs = 0020
  338:      SCIb_OutChar(number+'0');
  001a e681         [3]     LDAB  1,SP
  001c cb30         [1]     ADDB  #48
  339:    }
  001e 2004         [3]     BRA   *+6 ;abs = 0024
  340:    else{
  341:      SCIb_OutChar((number-0x0A)+'A');
  0020 e681         [3]     LDAB  1,SP
  0022 cb37         [1]     ADDB  #55
  0024 160000       [4]     JSR   SCIb_OutChar
  342:    }
  343:  }
  0027 3a           [3]     PULD  
  0028 3d           [5]     RTS   
  344:  
  345:  //------------------------SCIb_InString------------------------
  346:  // This function accepts ASCII characters from the serial port
  347:  //    and adds them to a string until a carriage return is inputted 
  348:  //    or until max length of the string is reached.  
  349:  // It echoes each character as it is inputted.  
  350:  // If a backspace is inputted, the string is modified 
  351:  //    and the backspace is echoed
  352:  // InString terminates the string with a null character
  353:  // -- Modified by Agustinus Darmawan + Mingjie Qiu --
  354:  void SCIb_InString(char *string, unsigned short max) {	
*** EVALUATION ***

Function: SCIb_InString
Source  : E:\Lab10\SCIB_DP512\Lab 10\Sources\SCIb.C
Options : -Cc -CPUHCS12 -D_HCS12_SERIALMON -D__NO_FLOAT__ -Env"GENPATH=E:\Lab10\SCIB_DP512\Lab 10;E:\Lab10\SCIB_DP512\Lab 10\bin;E:\Lab10\SCIB_DP512\Lab 10\prm;E:\Lab10\SCIB_DP512\Lab 10\cmd;E:\Lab10\SCIB_DP512\Lab 10\Sources;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\lib;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\src;C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"LIBPATH=C:\Program Files\Freescale\CodeWarrior for S12(X) V5.0\lib\HC12c\include" -Env"OBJPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Env"TEXTPATH=E:\Lab10\SCIB_DP512\Lab 10\bin" -Lasm=%n.lst -Ms -ObjN="E:\Lab10\SCIB_DP512\Lab 10\SCIB_DP512_Data\Standard\ObjectCode\SCIb.C.o" -WmsgSd1106

  0000 6cab         [2]     STD   5,-SP
  355:  int length=0;
  0002 c7           [1]     CLRB  
  0003 87           [1]     CLRA  
  0004 6c82         [2]     STD   2,SP
  356:  char character;
  357:    character = SCIb_InChar();
  358:    while(character!=CR){
  0006 202b         [3]     BRA   *+45 ;abs = 0033
  359:      if(character==BS){
  0008 c108         [1]     CMPB  #8
  000a 2613         [3/1]   BNE   *+21 ;abs = 001f
  360:        if(length){
  000c ee82         [3]     LDX   2,SP
  000e 2723         [3/1]   BEQ   *+37 ;abs = 0033
  361:          string--;
  0010 ed87         [3]     LDY   7,SP
  0012 03           [1]     DEY   
  0013 6d87         [2]     STY   7,SP
  362:          length--;
  0015 09           [1]     DEX   
  0016 6e82         [2]     STX   2,SP
  363:          SCIb_OutChar(BS);
  0018 c608         [1]     LDAB  #8
  001a 160000       [4]     JSR   SCIb_OutChar
  364:        }
  365:      }
  001d 2014         [3]     BRA   *+22 ;abs = 0033
  366:      else if(length<max){
  001f ee82         [3]     LDX   2,SP
  0021 ae80         [3]     CPX   0,SP
  0023 240e         [3/1]   BCC   *+16 ;abs = 0033
  367:        *string++=character;
  0025 ee87         [3]     LDX   7,SP
  0027 6b30         [2]     STAB  1,X+
  0029 6e87         [2]     STX   7,SP
  368:        length++; 
  002b ee82         [3]     LDX   2,SP
  002d 08           [1]     INX   
  002e 6e82         [2]     STX   2,SP
  369:        SCIb_OutChar(character);
  0030 160000       [4]     JSR   SCIb_OutChar
  370:      }
  371:      character = SCIb_InChar();
  0033 160000       [4]     JSR   SCIb_InChar
  0036 6b84         [2]     STAB  4,SP
  0038 c10d         [1]     CMPB  #13
  003a 26cc         [3/1]   BNE   *-50 ;abs = 0008
  372:    }
  373:    *string = 0;
  003c ee87         [3]     LDX   7,SP
  003e 6900         [2]     CLR   0,X
  374:  }
  0040 1b85         [2]     LEAS  5,SP
  0042 3d           [5]     RTS   
  375:  
  376:  
  377:  
